<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="default.css">
    <link type="text/css" rel="stylesheet" href="/assets/cmirror/codemirror.css">
    <link type="text/css" id="theme" rel="stylesheet" href="/assets/themes/solarized-dark.css">
    <script type="text/javascript" src="/assets/cmirror/codemirror.js"></script>
    <script type="text/javascript" src="/assets/cmirror/python.js"></script>
    <script type="text/javascript" src="onload.js"></script>
    <script type="text/javascript" src="codeblocks.js"></script>
    <script type="text/javascript" src="toc_order.js"></script>
    <script type="text/javascript" src="project.js"></script>
</head>
<body>
<header>
    <div id=title></div>
    <div id=description>This is a minecraft project</div>
    <div id=hw_required>
    Accelerometer Cell<br>
    LED Matrix Cell
    </div>
    <div id=troubleshooting><a href="TROUBLESHOOTING.html">Having issues?  Check out the Troubleshooting Guide.</a></div>
</header>

<h2>Overview</h2>
<p>In this project, we'll expand on our previous project where we integrated the LED
Matrix to indicate our position in the Minecraft world.  In the previous project, we
scaled our position in the Minecraft world to a position on the LED Matrix, but when
our scaled position was outside the LED Matrix boundary of 0 to 7, we forced it to 
either 0 or 7 and displayed it at that location.  

<p>In this project, when we determine that our character is outside the bounds of the 
LED Matrix, instead of just displaying the location as the edge of the LED Matrix,
we'll display the location at the edge and flash the LED.  This will indicate that
we're outside of the scaled world.

<h2>Hardware Setup</h2>
<img class="bb" src="img/LED_Matrix_bb.png">

<h2>Writing Our Code</h2>

<p>The main differnce between the code in the last project
and the code in this project is that, for this project, we'll
add an extra test to determine if the location of our character
is outside the boundaries of the LED Matrix, and if so, we'll 
flash the LED for as long as that condition continues to be
true.

<h3>Full Code</h3>

<p>
Here is what the full code for this project should look like.  We'll
dig further into the highlighted pieces of code below:
</p>

<div class="code" data-firstline="1"> <div></div> <textarea>
from rstem.led_matrix import FrameBuffer
from rstem.mcpi import minecraft, control
import time

control.show()

fb = FrameBuffer()

SCALE = 25
count = 0
FLASH_COUNT = 3
flash_lit = True

def scale_to_led(pos, scale)
    led_pos = round(pos/scale + .5*(fb_width - 1))
    if not 0 <= led_pos <= 7:
        flash_on = True
	else
	    flash_on = False
    led_pos = min(7, max(0, led_pos))
	return led_pos, flash_on
	
while True:
    pos = mc.player.getTilePos()

    flashing = False

    x, flash_x = scale_to_led(pos.x, SCALE)
    z, flash_z = scale_to_led(pos.x, SCALE)
    if flash_x == True or flash_z == True
	    flashing = True
	
    fb.erase()
    count += 1
    if count > FLASH_COUNT:
        flash_lit = not flash_lit
        count = 0
    if not flashing or flashing and flash_lit:
        fb.point(z, x)
    fb.show()

    time.sleep(0.01)
</textarea></div>

<h3><code>scale_to_led()</code> Function</h3>

<p>Like the function we wrote in the previous project, this
function will first scale the position in the Minecraft
world and map it to a whole number value.  In the previous 
project, we ensured that value was between 0 and 7, but in 
this project, we want to take appropriate action (flash the
LED) if it falls outside of that value.

<p>For that reason, after generating the whole number value,
our function will check to see if the value is between 0 and
7, and if it falls outside that range, we'll set our 
<code>flash_on</code> variable to True, indicating that we
are outside the range and should be flashing the LED.  After
that, we'll continue to convert our range to between 0 and 7,
and then we'll return both the position value and the value
of our <code>flash_on</code> variable.

<h3>Flashing the LED</h3>

<p>In our main game loop, after getting our position and setting
the default <code>flashing</code> variable value to False, we
pass both the X and Z location values to our function.  For
each, our function returns the LED value for that axis and
an indication of whether the LED should be flashing for 
that axis.  If either axis should result in the LED flashing,
we set our <code>flashing</code> variable to True before we
continue to our drawing code.

<p>Our drawing code first checks to see if our LED has been
lit (or not lit) for longer than our pre-defined flash duration, 
and if so, toggles the appropriate LED state and resets the count.
Finally, we check to see if the LED should be lit, and if so,
we plot that point on the LED Matrix.

<div id=footer></div>
</body></html>
